<!DOCTYPE html>
<meta charset="UTF-8"> 
<html>
<head>
	<script src="http://code.jquery.com/jquery-1.9.1.js"></script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js"></script>
</head>
<body>

<div ng-app="myApp" ng-controller="MainCtrl"> 			
	<div class="row">
		<div ng-class="{'panel-primary': nodeIsSelected, 'panel-info': !nodeIsSelected, 'col-xs-6': true, 'col-md-5': true, 'panel': true}">
			<div  class="panel-heading">External node (by default successor of local)</div>
			<div class="panel-body">
				</br>
				<button class="btn btn-default" ng-click="nodeIsSelected=true; selectedNode=distNode" ng-disabled="nodeIsSelected"> 
				select
				</button>
				</br>
				<label for="inputTest" class="col-sm-2 control-label">id</label>	
				<input class="form-control" id="inputDistId" placeholder={{distNode.Id}} ng-model="distNode.Id">
				
				</br>
				<label for="inputTest" class="col-sm-2 control-label">ip</label>	
				<input class="form-control" id="inputDistIp" placeholder={{distNode.Ip}} ng-model="distNode.Ip">
				
				</br>
				<label for="inputTest" class="col-sm-2 control-label">port</label>	
				<input class="form-control" id="inputDistPort" placeholder={{distNode.Port}} ng-model="distNode.Port">
							
				</br>
			</div>
		</div>

		<div ng-class="{'panel-primary': !nodeIsSelected, 'panel-default': nodeIsSelected, 'col-xs-6': true, 'col-md-5': true, 'panel': true}">
			<div class="panel-heading">Personnal node</div>
			<div class="panel-body">
				</br>
				<button class="btn btn-default" ng-disabled="!nodeIsSelected" ng-click="nodeIsSelected=false;selectedNode=localNode"> 
					select
				</button>
				</br>

				<label for="inputTest" class="col-sm-2 control-label">id</label>	
				<input class="form-control" id="inputLocId" placeholder={{localNode.Id}} ng-model="localNode.Id">		
				</br>
				<label for="inputTest" class="col-sm-2 control-label">ip</label>	
				<input class="form-control" id="inputLocIp" placeholder={{localIp}} ng-model="localIp">
				
				</br>
				<label for="inputTest" class="col-sm-2 control-label">port</label>	
				<input class="form-control" id="inputLocPort" placeholder={{localPort}} ng-model="localPort">
				
				</br>
				<label for="inputTest" class="col-sm-2 control-label">successor</label>	
				<input class="form-control" id="inputLocSuc" placeholder={{localNode.Successor.Id}} ng-model="localNode.Successor.Id">
				
				</br>
				<label for="inputTest" class="col-sm-2 control-label">predecessor</label>	
				<input class="form-control" id="inputLocPre" placeholder={{localNode.Predecessor.Id}} ng-model="localNode.Predecessor.Id">				
				</br>
			</div>
		</div>

		<div class="col-xs-12 col-md-8 panel panel-default">
			<div class="panel-body">
			future graph visualisation
			</br>
			<button class="btn btn-default" ng-click="getAllNodes(false)" ng-init="init()"> 
				maj data of selected node
			</button>
			<button class="btn btn-default" ng-click="getAllNodes(true)"> 
				reinit datas from selected node
			</button>
			</br>
			nodes : {{nodes}}
			</br>
			local : {{localNode}}
			</br>
			
			</div>
		</div>
	</div>
</div>

<script>

var app = angular.module('myApp', []);

app.config(function($httpProvider) {
  //Enable cross domain calls
  $httpProvider.defaults.useXDomain = true;

  //Remove the header used to identify ajax call  that would prevent CORS from working
  delete $httpProvider.defaults.headers.common['X-Requested-With'];
});

app.controller('MainCtrl', function($scope, $http) {
	$scope.init = function () {           
        $scope.nodeIsSelected = false;
        $scope.localIp = "127.0.0.1";
        $scope.localPort = "4321";

        $scope.getAllNodes(true);      
    }

    $scope.getAllNodes = function (isInit){

    	var urlReq;
    	if ($scope.nodeIsSelected){
    		urlReq = 'http://' + $scope.selectedNode.Ip + ':' + $scope.selectedNode.Port + '/nodes';
    	} else{
    		urlReq = 'http://' + $scope.localIp + ':' + $scope.localPort + '/nodes';
    	}
    	
		$http({
			method: 'GET', 
			url: urlReq,
			respondType: 'json'//optionnel
        }).
		success(function(data, status, headers, config) {
			$scope.nodes = data;
			$scope.status = status;
			
			if (isInit){
				$scope.nodeIsSelected = false;
				$scope.localNode = $scope.nodes;
				$scope.selectedNode = $scope.localNode;
				$scope.distNode = $scope.localNode.Successor
			} else {
				if (!$scope.nodeIsSelected){
					$scope.localNode = $scope.nodes;				
				} else{
					$scope.distNode = $scope.nodes;		
				}
			}
			if($scope.localNode){
				$scope.localIp = $scope.localNode.Ip;
				$scope.localPort = $scope.localNode.Port;
			}
		}).
		error(function(data, status, headers, config) {
			console.log("error status : "+ status);
			$scope.nodes = data;
			$scope.status = status;
	  });
	}

});
</script>

</body>
</html>
