<!DOCTYPE html>
<meta charset="UTF-8">
<html>

<head>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.min.js"></script>
</head>

<body>

    <div ng-app="myApp" ng-controller="MainCtrl">
        <div class="container">
            <div class="row">
                <div class="page-header">
                    <h1>Node interface</h1>
                </div>
                <!--             <div ng-class="{'panel-primary': nodeIsSelected, 'panel-info': !nodeIsSelected, 'col-xs-6': true, 'col-md-5': true, 'panel': true}">
                <div class="panel-heading">External node (by default successor of local)</div>
                <div class="panel-body">
                    <button class="btn btn-default" ng-click="nodeIsSelected=true; selectedNode=distNode" ng-disabled="nodeIsSelected">
                        select
                    </button>
                    </br>
                    <label for="inputTest" class="col-sm-2 control-label">id</label>
                    <input class="form-control" id="inputDistId" placeholder={{distNode.Id}} ng-model="distNode.Id">

                    <label for="inputTest" class="col-sm-2 control-label">ip</label>
                    <input class="form-control" id="inputDistIp" placeholder={{distNode.Ip}} ng-model="distNode.Ip">

                    <label for="inputTest" class="col-sm-2 control-label">port</label>
                    <input class="form-control" id="inputDistPort" placeholder={{distNode.Port}} ng-model="distNode.Port">
                </div>
            </div> -->
                <div class="col-md-6 bs-docs-section">

                    <div ng-class="{'panel-primary': !nodeIsSelected, 'panel-default': nodeIsSelected, 'panel': true}">
                        <div class="panel-heading">
                            <h4>
                                Node Informations
                            </h4>
                        </div>
                        <div class="panel-body">
                            <!--                             <button class="btn btn-default" ng-disabled="!nodeIsSelected" ng-click="nodeIsSelected=false;selectedNode=localNode">
                                select
                            </button> -->

                            <form class="form-horizontal">
                                <fieldset>
                                    <div class="form-group">
                                        <label for="inputTest" class="col-sm-2 control-label">id</label>
                                        <div class="col-lg-10">
                                            <input class="form-control" id="inputLocId" placeholder={{localNode.Id}} disabled="" ng-model="localNode.Id">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputTest" class="col-sm-2 control-label">ip</label>
                                        <div class="col-lg-10">
                                            <input class="form-control" id="inputLocIp" placeholder={{localIp}} disabled="" ng-model="localIp">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputTest" class="col-sm-2 control-label">port</label>
                                        <div class="col-lg-10">
                                            <input class="form-control" id="inputLocPort" placeholder={{localPort}} disabled="" ng-model="localPort">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputTest" class="col-sm-2 control-label">successor</label>
                                        <div class="col-lg-10">
                                            <input class="form-control" id="inputLocSuc" placeholder={{localNode.Successor.Id}} disabled="" ng-model="localNode.Successor.Id">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="inputTest" class="col-sm-2 control-label">predecessor</label>
                                        <div class="col-lg-10">
                                            <input class="form-control" id="inputLocPre" placeholder={{localNode.Predecessor.Id}} disabled="" ng-model="localNode.Predecessor.Id">
                                        </div>
                                    </div>
                                </fieldset>
                            </form>

                        </div>
                    </div>

                </div>

                <div class="col-xs-12 col-md-6 bs-docs-section">

                    <div class=" panel panel-default">
                        <div class="panel-heading clearfix">
                            <div class="panel-title">
                                <h3>
                                    datas control

                                    <div class="btn-group pull-right">
                                        <button class="btn btn-success" ng-click="addData()">
                                            add
                                        </button>

                                        <button class="btn btn-primary" ng-click="getData()">
                                            get
                                        </button>

                                        <button class="btn btn-danger" ng-click="removeData()">
                                            remove
                                        </button>

                                        <button class="btn btn-info" ng-click="majData()">
                                            maj
                                        </button>
                                    </div>
                                </h3>
                            </div>
                        </div>
                        <div class="panel-body">
                            <form class="form-horizontal">
                                <fieldset>
                                    <div class="form-group">
                                        <label for="inputKey" class="col-sm-2 control-label">key</label>
                                        <div class="col-lg-10">
                                            <input class="form-control" id="inputKey" placeholder={{keyFocus}} ng-model="keyFocus">
                                        </div>
                                    </div>
                                    <div class="form-group">

                                        <label for="inputValue" class="col-sm-2 control-label">value</label>
                                        <div class="col-lg-10">
                                            <input class="form-control" id="inputValue" placeholder={{valueFocus}} ng-model="valueFocus">
                                        </div>
                                    </div>
                                    <div class="form-group">

                                        <label for="inputTa" class="col-sm-2 control-label">tag</label>
                                        <div class="col-lg-10">
                                            <p>

                                                <input class="form-control" id="inputValue" placeholder={{tagFocus}} disabled="" ng-model="tagFocus">
                                            </p>
                                        </div>
                                    </div>
                                </fieldset>
                            </form>
                            <div class="well">

                                <ul>
                                    <li class="alert alert-info" ng-repeat="(key, data) in selectedNode.Datas.Set" ng-click="changeDataFocus(key, data)">
                                        <div>
                                                                                    <div class="pull-right">
<div ng-if="data.Tag == localNode.Id">
    <div class="label label-success ">Own if</div>
</div>
                                                <div ng-switch on="data.Tag">
                                                    <div ng-switch-when="localNode.Id">
                                                        <div class="label label-success ">Own switch</div>
                                                    </div>
                                                    <div ng-switch-default>
                                                        <!-- code to render the regular video block -->
                                                        <div class="label label-default ">Other</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div>
                                                key : {{key}}
                                            </div>
                                            <div>

                                                Value : {{data.Value}}
                                            </div>

                <!--                             <div class="label pull-right" ng-class="(localNode.Id==data.Tag) ? 'label-default' : 'label-success'">

                                                Tag : {{data.Tag}}
                                            </div> -->

                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>


                    </div>
                </div>

            </div>

            <div class="col-xs-12 col-md-8 panel panel-default">
                <div class="panel-body">
                    future graph visualisation
                    </br>
                    <button class="btn btn-default" ng-click="getAllNodes(false)" ng-init="init()">
                        maj data of selected node
                    </button>
                    <button class="btn btn-default" ng-click="getAllNodes(true)">
                        reinit datas from selected node
                    </button>
                    </br>
                    nodes : {{nodes}}
                    </br>

                </div>
            </div>
        </div>
    </div>

    <script>
    var app = angular.module('myApp', []);

    app.config(function($httpProvider) {
        //Enable cross domain calls
        $httpProvider.defaults.useXDomain = true;

        //Remove the header used to identify ajax call  that would prevent CORS from working
        delete $httpProvider.defaults.headers.common['X-Requested-With'];
    });

    app.controller('MainCtrl', function($scope, $http) {
        $scope.init = function() {
            $scope.nodeIsSelected = false;
            $scope.localIp = "127.0.0.1";
            $scope.localPort = "4321";

            $scope.getAllNodes(true);
        }

        $scope.getAllNodes = function(isInit) {
            var urlReq;
            if ($scope.nodeIsSelected) {
                urlReq = 'http://' + $scope.selectedNode.Ip + ':' + $scope.selectedNode.Port + '/nodes';
            } else {
                urlReq = 'http://' + $scope.localIp + ':' + $scope.localPort + '/nodes';
            }
            $http({
                method: 'GET',
                url: urlReq,
                respondType: 'json' //optionnel
            }).
            success(function(data, status, headers, config) {
                $scope.nodes = data;
                $scope.status = status;

                if (isInit) {
                    $scope.nodeIsSelected = false;
                    $scope.localNode = $scope.nodes;
                    $scope.selectedNode = $scope.localNode;
                    $scope.distNode = $scope.localNode.Successor
                } else {
                    if (!$scope.nodeIsSelected) {
                        $scope.localNode = $scope.nodes;
                        $scope.selectedNode = $scope.localNode;
                    } else {
                        $scope.distNode = $scope.nodes;
                        $scope.selectedNode = $scope.distNode;
                    }
                }
                if ($scope.localNode) {
                    $scope.localIp = $scope.localNode.Ip;
                    $scope.localPort = $scope.localNode.Port;
                }

                for (key in $scope.selectedNode.Datas.Set) {
                    $scope.keyFocus = key;
                    $scope.valueFocus = $scope.selectedNode.Datas.Set[key].Value;
                    $scope.tagFocus = $scope.selectedNode.Datas.Set[key].Tag;
                    break;
                }

            }).
            error(function(data, status, headers, config) {
                console.log("error status : " + status);
                $scope.nodes = data;
                $scope.status = status;
            });
        }

        $scope.getData = function() {
            var urlReq;
            if ($scope.nodeIsSelected) {
                urlReq = 'http://' + $scope.selectedNode.Ip + ':' + $scope.selectedNode.Port + '/storage/' + $scope.keyFocus;
            } else {
                urlReq = 'http://' + $scope.localIp + ':' + $scope.localPort + '/storage/' + $scope.keyFocus;
            }
            $http({
                method: 'GET',
                url: urlReq,
                respondType: 'json' //optionnel
            }).
            success(function(data, status, headers, config) {
                $scope.status = status;
                console.log(data);

            }).
            error(function(data, status, headers, config) {
                console.log("error status : " + status);
                $scope.status = status;
            });
        }

        $scope.addData = function() {
            var urlReq;
            if ($scope.nodeIsSelected) {
                urlReq = 'http://' + $scope.selectedNode.Ip + ':' + $scope.selectedNode.Port + '/storage';
            } else {
                urlReq = 'http://' + $scope.localIp + ':' + $scope.localPort + '/storage';
            }
            $http({
                method: 'POST',
                url: urlReq,
                respondType: 'json', //optionnel
                data: {
                    Key: $scope.keyFocus,
                    Value: $scope.valueFocus
                }
            }).
            success(function(data, status, headers, config) {
                $scope.status = status;
                $scope.getAllNodes(false);
            }).
            error(function(data, status, headers, config) {
                console.log("error status : " + status);
                $scope.status = status;
            });
        }

        $scope.removeData = function() {
            var urlReq;
            if ($scope.nodeIsSelected) {
                urlReq = 'http://' + $scope.selectedNode.Ip + ':' + $scope.selectedNode.Port + '/storage/' + $scope.keyFocus;
            } else {
                urlReq = 'http://' + $scope.localIp + ':' + $scope.localPort + '/storage/' + $scope.keyFocus;
            }
            $http({
                method: 'DELETE',
                url: urlReq,
                respondType: 'json' //optionnel
            }).
            success(function(data, status, headers, config) {
                $scope.status = status;
            }).
            error(function(data, status, headers, config) {
                console.log("error status : " + status);
                $scope.status = status;
            });
        }

        $scope.majData = function() {
            var urlReq;
            if ($scope.nodeIsSelected) {
                urlReq = 'http://' + $scope.selectedNode.Ip + ':' + $scope.selectedNode.Port + '/storage/' + $scope.keyFocus;
            } else {
                urlReq = 'http://' + $scope.localIp + ':' + $scope.localPort + '/storage/' + $scope.keyFocus;
            }
            $http({
                method: 'PUT',
                url: urlReq,
                respondType: 'json', //optionnel
                data: {
                    Key: $scope.keyFocus,
                    Value: $scope.valueFocus
                }
            }).
            success(function(data, status, headers, config) {
                $scope.status = status;
                $scope.getAllNodes();
            }).
            error(function(data, status, headers, config) {
                console.log("error status : " + status);
                $scope.status = status;
            });
        }

        $scope.changeDataFocus = function(key, data) {
            console.log(data);
            $scope.keyFocus = key;
            $scope.valueFocus = data.Value;
            $scope.tagFocus = data.Tag;
        }



    });
    </script>

</body>

</html>
